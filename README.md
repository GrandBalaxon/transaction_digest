# Transaction Digest

## Описание:

Этот проект представляет собой бэкенд-компонент виджета для личного кабинета клиента банка. 
Виджет отображает несколько последних успешных банковских операций клиента.

## Установка:

1.  Установите [Poetry](https://python-poetry.org/docs/#installation).

2. Установите [Git](https://git-scm.com/downloads/win).

3. Клонируйте репозиторий:
```
git clone https://github.com/GrandBalaxon/transaction_digest.git
cd TransactionDigest
```

4. Установите зависимости проекта:
```
poetry install
```

## Использование:

(Здесь нужно будет добавить инструкции по использованию, когда `main.py` будет реализован)

## Функциональность:

Проект состоит из нескольких модулей в пакете `src`, их функциональность расписана далее.

### Формат входных данных на работу с которым настроены функции:

На вход ожидаются списки словарей следующего формата.
```
"id": 939719570,
"state": "EXECUTED",
"date": "2018-06-30T02:08:58.425572",
"operationAmount": {
  "amount": "9824.07",
  "currency": {
      "name": "USD",
      "code": "USD"
  }
},
"description": "Перевод организации",
"from": "Счет 75106830613657916952",
"to": "Счет 11776614605963066702"
```

Формат даты `"2018-06-30T02:08:58.425572"` - расширенный ISO 8601 с указанием даты, времени и 6 символов микросекунд.

В некоторых примерах работы функций показана работа с сокращенными по количеству данных словарями для упрощения вывода.

### `masks.py`
Предоставляет функции для маскировки номеров банковских карт и счетов в соответствии с политиками безопасности банка.

#### * `get_mask_card_number(card_number)`
Маскирует номер банковской карты в формате `XXXX XX** **** XXXX`, где `X` — это цифра номера.

##### Пример работы функции:
```
card_number = "7000792289606361"
print(get_mask_card_number(card_number))

>>> 7000 79** **** 6361
```

#### * `get_mask_account(acc_number)`
Маскирует номер счета в формате `**XXXX`, где `X` — это цифра номера.

##### Пример работы функции:
```
acc_number = "73654108430135874305"
print(get_mask_account(acc_number))

>>> **4305
```

### `processing.py`
Предоставляет функции для фильтрации и сортировки данных об операциях.

#### * `filter_by_state(list_of_dicts, state="EXECUTED")`
Фильтрует список операций по статусу (по умолчанию "EXECUTED").

##### Пример работы функции:
```
transactions_list = [
    {'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
    {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}, 
    {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
    {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
]
filtered_transactions_list = filter_by_state(transactions_list, state='CANCELED')
print(filtered_transactions_list)

>>> [
        {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
        {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
    ]
```

#### * `sort_by_date(list_of_dicts, descending=True)`
Сортирует список операций по дате.

`descending`: `True` (по умолчанию) - сортировка по убыванию (от новых к старым).
                `False` - сортировка по возрастанию (от старых к новым).

##### Пример работы функции:
```
transactions_list = [
    {'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
    {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}, 
    {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
    {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
]
sorted_transactions_list = sort_by_date(transactions_list)
print(sorted_transactions_list)

>>> [
        {'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
        {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, 
        {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
        {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}
    ]
```

### `widget.py`
Предоставляет функции для форматирования данных для виджета.

#### * `mask_account_card(type_and_number)` 
Маскирует номер карты или счета в строке.

##### Пример работы функции:
```
card = "Visa Platinum 7000792289606361"
account = "Счет 73654108430135874305"
print(
    mask_account_card(card), mask_account_card(account), sep="\n"
)

>>> Visa Platinum 7000 79** **** 6361
    Счет **4305
```

#### * `get_date(date)`
Форматирует дату в формат `ДД.ММ.ГГГГ`.

##### Пример работы функции:
```
date = "2024-03-11T02:26:18.671407"
print(get_date(date))

>>> 11.03.2024
```

### `generators.py`
Предоставляет функции для генерации для работы с массивами данных.

#### * `filter_by_currency(transactions_list, currency)` 

   Функция-генератор которая принимает на вход список словарей с транзакциями.
   Возвращает итератор, который поочередно выдает транзакции, где валюта операции соответствует заданной "currency" 
   (например, USD).

##### Пример работы функции:
```
usd_transactions = filter_by_currency(transactions, "USD")
for _ in range(2):
    print(next(usd_transactions))

>>> {
          "id": 939719570,
          "state": "EXECUTED",
          "date": "2018-06-30T02:08:58.425572",
          "operationAmount": {
              "amount": "9824.07",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод организации",
          "from": "Счет 75106830613657916952",
          "to": "Счет 11776614605963066702"
      }
      {
          "id": 142264268,
          "state": "EXECUTED",
          "date": "2019-04-04T23:20:05.206878",
          "operationAmount": {
              "amount": "79114.93",
              "currency": {
                  "name": "USD",
                  "code": "USD"
              }
          },
          "description": "Перевод со счета на счет",
          "from": "Счет 19708645243227258542",
          "to": "Счет 75651667383060284188"
       }
```

#### * `transaction_descriptions(transactions_list)`

Функция-генератор которая принимает список словарей с транзакциями. 
Возвращает генератор выдающий описание каждой операции по очереди.

##### Пример работы функции:
```
descriptions = transaction_descriptions(transactions)
for _ in range(5):
    print(next(descriptions))

>>> Перевод организации
    Перевод со счета на счет
    Перевод со счета на счет
    Перевод с карты на карту
    Перевод организации
```
#### * `card_number_generator(start, finish)`

Функция-генератор который выдает номера банковских карт в формате `XXXX XXXX XXXX XXXX`, где `X` — цифра номера карты.
Генератор может сгенерировать номера карт в заданном диапазоне от `0000 0000 0000 0001` до `9999 9999 9999 9999`.
Генерация значений происходит от меньшего к большому.
На `start` и `finish` подаются строковые или численные значения.
При указывании значения от большего к меньшему - функция всё равно отработает как полагается, поменяв их местами.

##### Пример работы функции:
```
for card_number in card_number_generator(1, 5):
    print(card_number)

>>> 0000 0000 0000 0001
    0000 0000 0000 0002
    0000 0000 0000 0003
    0000 0000 0000 0004
    0000 0000 0000 0005
```

## Тестирование 

Этот проект использует `pytest` для автоматизированного тестирования.
Он должен быть уже у вас установлен, если вы прошли шаги с установкой проекта. 

Перед началом тестирования убедитесь, что у вас активировано виртуальное окружение проекта, а также, что вы находитесь в корневой директории проекта.

Для запуска всех тестов из директории `tests/` используйте команду:
```bash
pytest
```

Для проверки покрытия кода использован `pytest-cov`.
* Используйте следующую команду для отображения информации о покрытии внутри терминала
```bash
pytest --cov
```
* чтобы сгенерировать отчет о покрытии в HTML-формате, где `src` — пакет c модулями, которые тестируем. 
Отчет будет сгенерирован в папке `htmlcov` и храниться в файле с названием `index.html`.
```bash
pytest --cov=src --cov-report=html
```

## Лицензия:

Этот проект лицензирован по [лицензии MIT](LICENSE).

